---
title: "Relacionar El Desempeño De Diversos Equipos De Futbol Profesionales En Distintos Ambientes A lo Largo De Las Temporadas Para Determinar Como Influye Esto En Su Desenvolvimiento Durante la Temporada"
author: "Contreras Valeria, Guillén David, Zamora Samuel"
date: "Junio del 2024"
output: 
  pdf_document:
    toc: TRUE
    toc_depth: 3
fontside: 11pt
lang: Es-es
---

![Escuela de Estadística y Ciencias Actuariales]("C:\\Users\\guill\\Documents\\Trabajos\\Fútbol_TF - Repo\\Proyecto - Fútbol\\Imagenes Extras\\Logo de la EECA.png"){width='120px'}

```{r Bliblioteca, include=FALSE}
#Paquetes a utilizar
library(tinytex)
library(DBI)
library(RSQLite)
library(tidyverse)
library(cowplot)
library(summarytools)
library(kableExtra)
library(waffle)

#BBDD
futbol <- dbConnect(SQLite(), dbname = "Fútbol Europeo BBDD.sqlite")

#Funciones
moda<- function(x) {
   return(as.numeric(names(which.max(table(x)))))
}

#Tablas de la BBDD
Divisiones <- dbGetQuery(futbol, "SELECT * FROM Divisiones")
Partidos <- dbGetQuery(futbol, "SELECT * FROM Partidos")

#Variables
Primera_Segunda <- dbGetQuery(futbol,"SELECT * FROM Primera_Segunda") 
Primera_Segunda <- Primera_Segunda %>% mutate(total_puntos = Puntos_local + Puntos_visitante) %>% select(Equipo, Puntos_local, Puntos_visitante, total_puntos, Temporada)

    #Arreglando Datos (filtrado y % proporsión) datos - Graficos1 Obj.1

Burnley_15 <- Primera_Segunda %>% filter(Equipo == "Burnley", Temporada == "2014-15") %>% mutate(Porcentaje_Por_Partido = total_puntos / 114 * 100) %>% mutate(across(6, ~ round(., 2)))
Burnley_16 <- Primera_Segunda %>% filter(Equipo == "Burnley", Temporada == "2015-16") %>% mutate(Porcentaje_Por_Partido = total_puntos / 138 * 100) %>% mutate(across(6, ~ round(., 2)))

QPR_15 <- Primera_Segunda %>% filter(Equipo == "QPR", Temporada == "2014-15") %>% mutate(Porcentaje_Por_Partido = total_puntos / 114 * 100) %>% mutate(across(6, ~ round(., 2)))
QPR_16 <- Primera_Segunda %>% filter(Equipo == "QPR", Temporada == "2015-16") %>% mutate(Porcentaje_Por_Partido = total_puntos / 138 * 100) %>% mutate(across(6, ~ round(., 2)))

Hull_15<- Primera_Segunda %>% filter(Equipo == "Hull", Temporada == "2014-15") %>% mutate(Porcentaje_Por_Partido = total_puntos / 114 * 100) %>% mutate(across(6, ~ round(., 2)))
Hull_16 <- Primera_Segunda %>% filter(Equipo == "Hull", Temporada == "2015-16") %>% mutate(Porcentaje_Por_Partido = total_puntos / 138 * 100) %>% mutate(across(6, ~ round(., 2)))

Bournemouth_15<- Primera_Segunda %>% filter(Equipo == "Bournemouth", Temporada == "2014-15") %>% mutate(Porcentaje_Por_Partido = total_puntos / 138 * 100) %>% mutate(across(6, ~ round(., 2)))
Bournemouth_16 <- Primera_Segunda %>% filter(Equipo == "Bournemouth", Temporada == "2015-16") %>% mutate(Porcentaje_Por_Partido = total_puntos / 114 * 100) %>% mutate(across(6, ~ round(., 2)))

Norwich_15<- Primera_Segunda %>% filter(Equipo == "Norwich", Temporada == "2014-15") %>% mutate(Porcentaje_Por_Partido = total_puntos / 138 * 100) %>% mutate(across(6, ~ round(., 2)))
Norwich_16 <- Primera_Segunda %>% filter(Equipo == "Norwich", Temporada == "2015-16") %>% mutate(Porcentaje_Por_Partido = total_puntos / 114 * 100) %>% mutate(across(6, ~ round(., 2)))

Watford_15<- Primera_Segunda %>% filter(Equipo == "Watford", Temporada == "2014-15") %>% mutate(Porcentaje_Por_Partido = total_puntos / 138 * 100) %>% mutate(across(6, ~ round(., 2)))
Watford_16 <- Primera_Segunda %>% filter(Equipo == "Watford", Temporada == "2015-16")  %>% mutate(Porcentaje_Por_Partido = total_puntos / 114 * 100) %>% mutate(across(6, ~ round(., 2)))

  #Rendimiento de los equipos en segunda + muestra - Graficos2 Obj.2

muestra <- Primera_Segunda[c(4:6, 13:15), c("Equipo", "total_puntos")]
VS <- c(rep(1, 3), rep(2, 3))
Datos1 <- data.frame(muestra, VS)
remove(muestra)

  #Rendimiento de los equipos en primera + muestra - Graficos2 Obj.2
muestra <- Primera_Segunda[c(10:12, 16:18), c("Equipo", "total_puntos")]
Datos2 <- data.frame(muestra, VS)
remove(VS, muestra)


v_ath <- dbGetQuery(futbol,
"SELECT * FROM (SELECT Id_Partidos, Team_Local AS Equipo, Ganador
				FROM Partidos 
					WHERE Cod_Division='SP1' AND Team_Local='Ath Bilbao'
				UNION
			   SELECT * FROM Obj_21)
	ORDER BY Ganador")
v_ath <- v_ath %>% mutate(Lugar = case_when(Equipo == "Ath Bilbao" ~ "Local", Equipo == "Ath Bilbao." ~ "Visitante")) %>% mutate(Ganador = recode(Ganador, "E" = "Empate", "L" = "Local", "V" = "Visitante"))

v_man <- dbGetQuery(futbol,
"SELECT * FROM (SELECT Id_Partidos, Team_Local AS Equipo, Ganador
				FROM Partidos 
					WHERE Cod_Division='E0' AND Team_Local='Man City'
				UNION
			   SELECT * FROM Obj_22)
	ORDER BY Ganador")
v_man <- v_man %>% mutate(Lugar = case_when(Equipo == "Man City" ~ "Local", Equipo == "Man City." ~ "Visitante")) %>% mutate(Ganador = recode(Ganador, "E" = "Empate", "L" = "Local", "V" = "Visitante"))

var_bundes_antes <- dbGetQuery(futbol,
"SELECT * FROM Obj_31
  WHERE Temporada = '2016-17'")
var_bundes_antes <- var_bundes_antes %>% mutate(Equipo = recode(Equipo, "Ein Frankfurt" = "Eintracht", "Freiburg" = "Friburgo"))
var_bundes_despues <- dbGetQuery(futbol,
"SELECT * FROM Obj_31
  WHERE Temporada = '2017-18'")
var_bundes_despues <- var_bundes_despues %>% mutate(Equipo = recode(Equipo, "Ein Frankfurt" = "Eintracht", "Freiburg" = "Friburgo"))

var_laliga_antes <- dbGetQuery(futbol,
"SELECT * FROM Obj_32
  WHERE Temporada = '2017-18'")
var_laliga_despues <- dbGetQuery(futbol,
"SELECT * FROM Obj_32
  WHERE Temporada = '2018-19'")

  #Traer todos los partidos del Atletic de Bilbao (2017-18, 2018-19) - Graficos5 Obj.4

partidos_ath <- dbGetQuery(futbol, 
"SELECT Team_Local AS Equipo, Resultado, count(Resultado) As Total_Resultados, Temporada 
FROM(SELECT Team_Local, Team_Visitante,
CASE
	WHEN Team_Local='Ath Bilbao' AND Ganador='L' THEN 'Victoria'
	WHEN Team_Local='Ath Bilbao' AND Ganador='V' THEN 'Derrota'
	ELSE 'Empate' 
END AS Resultado, Temporada FROM Partidos
	WHERE Team_Local='Ath Bilbao' AND Temporada IN ('2017-18', '2018-19')

UNION ALL

SELECT Team_Visitante, Team_Local,
CASE
	WHEN Team_Visitante='Ath Bilbao' AND Ganador='L' THEN 'Victoria'
	WHEN Team_Visitante='Ath Bilbao' AND Ganador='V' THEN 'Derrota'
	ELSE 'Empate' 
END AS Resultado, Temporada FROM Partidos
	WHERE Team_Visitante='Ath Bilbao' AND Temporada IN ('2017-18', '2018-19'))
GROUP BY Resultado, Temporada
ORDER BY Temporada")
p_ath_a <- partidos_ath %>% filter(Temporada == "2017-18")
p_ath_d <- partidos_ath %>% filter(Temporada == "2018-19")
remove(partidos_ath)

  #Traer todos los partidos del RC Celta (2017-18, 2018-19) - Graficos5 Obj.4

partidos_celta <- dbGetQuery(futbol, 
"SELECT Team_Local AS Equipo, Resultado, count(Resultado) As Total_Resultados, Temporada 
FROM(SELECT Team_Local, Team_Visitante,
CASE
	WHEN Team_Local='Celta' AND Ganador='L' THEN 'Victoria'
	WHEN Team_Local='Celta' AND Ganador='V' THEN 'Derrota'
	ELSE 'Empate' 
END AS Resultado, Temporada FROM Partidos
	WHERE Team_Local='Celta' AND Temporada IN ('2017-18', '2018-19')

UNION ALL

SELECT Team_Visitante, Team_Local,
CASE
	WHEN Team_Visitante='Celta' AND Ganador='L' THEN 'Victoria'
	WHEN Team_Visitante='Celta' AND Ganador='V' THEN 'Derrota'
	ELSE 'Empate' 
END AS Resultado, Temporada FROM Partidos
	WHERE Team_Visitante='Celta' AND Temporada IN ('2017-18', '2018-19'))
GROUP BY Resultado, Temporada
ORDER BY Temporada")
p_celta_a <- partidos_celta %>% filter(Temporada == "2017-18")
p_celta_d <- partidos_celta %>% filter(Temporada == "2018-19")
remove(partidos_celta)
```

\pagebreak
# Planteamiento del Problema

 El fútbol es un deporte a nivel profesional alto de once jugadores por equipo en el juego, involucra la cooperación mutua del equipo y se sabe que es un deporte que conlleva el contacto. Estos equipos tienen la misión de trasladar un balón utilizando cualquier parte del cuerpo exceptuando brazos y manos con la finalidad de encajarlo dentro de la portería o arco del conjunto rival, acción que se denomina gol. El equipo con más goles durante un partido de 90 minutos ganará el encuentro.

 Pueden existir partidos en los que un equipo sea tácticamente muy superior al rival, o que cuente con jugadores de mejor calidad. Al final del partido puede influir en que dominen en estadísticas como mayor posesión de balón, mayor precisión en los pases, más disparos al arco rival, mayor cantidad de tiros libres y todo lo que pueda favorecer a un equipo para demostrar que es superior, pero lo único que sentencia un partido son los goles, y ganar como en cualquier deporte es la única manera de avanzar en un torneo o competición.

 Ya que marcar goles para cualquier equipo es una necesidad, resulta interesante develar qué factores pueden influir en los equipos para que aumente o disminuya su capacidad goleadora.

 Se tiene en estudio una base de datos relacionados a algunas ligas del fútbol europeo, entre ellas las 5 más importantes del mundo según la plataforma Global Football Rankings, que utiliza análisis de datos para evaluar y clasificar las ligas de fútbol en todo el mundo, esta plataforma concluye que en este top se encuentran la Premier League (Inglaterra), La Bundesliga (Alemania), LaLiga (España), Serie A (Italia) y Ligue 1 (Francia).  
 La base de datos cuenta con variables como los goles anotados por los equipos de cada liga tanto de local como de visitante, a lo largo de las temporadas que transcurrieron desde el año 2006 hasta el año 2021.

 El objetivo del presente trabajo estadístico es exponer y demostrar algunos factores determinantes que tienen influencia en la cantidad de goles y victorias que se pueden llevar un equipo partido a partido. Todo esto en base a la secuencia de partidos de las ligas y divisiones que están registradas en la BBDD.  
 Trabajaremos con unas muestras de la BBDD la cual consta principalmente del equipo "Athletic Club" de Bilbao que juega en la primera división de “La Liga”, el campeonato nacional de España. Mientras avanzamos con el desarrollo del trabajo, también se expondrán otros equipos aleatorios a las pruebas del objetivo junto al principal anteriormente mencionado.


## Interrogantes/Objetivos

1) ¿El ascenso o descenso de liga de un equipo sentencia su lugar en la tabla de posiciones?

2) ¿Los equipos tienden a ganar más cuando juegan en sus estadios locales?

3) ¿Cuál fué el efecto en la consistencia reflejada en la cantidad de goles en las ligas tras la implementación del Video Assistant Referee (VAR)?

4) ¿Puede distinguir un cambio de entrenador y/o jugadores del equipo para un dominio del marcador en su mayoría de juegos?

\pagebreak
# Resumen Descriptivo de la BBDD

 A continuación, un cuadro con detalles de la estadística descriptiva para la evaluación de las variables cuantitativas de la base de datos en estudio.

```{r Resumen Descriptivo - Futbol, echo=FALSE}
Partidos <- dbGetQuery(futbol, 
"SELECT Goles_Local, Goles_Visitante FROM Partidos")

tb_resumen1 <- Partidos %>% descr(stats = c("mean", "sd", "min", "q1", "med", "q3", "max","cv"), transpose = TRUE) %>% tb(order = 3) %>% mutate("Total de datos"=c(length(Partidos$Goles_Local), length(Partidos$Goles_Visitante)), Moda=c(moda(Partidos$Goles_Local), moda(Partidos$Goles_Visitante))) %>% select(c(1, 10, 11, 2, 3, 4, 5, 6, 7, 8, 9)) %>% rename(Variable=variable, Media=mean, "Desv-Std"=sd, Min=min, Q1=q1, Med=med, Q3=q3, Max=max, CV=cv) %>% mutate(Variable= recode(Variable, "Goles_Local" = "Goles Local", "Goles_Visitante" = "Goles Visitante")) %>% mutate(CV=CV*100) %>% mutate(across(c(4,5,11), ~ round(., 2)))

tb_resumen1 %>% kable() %>% kable_styling(bootstrap_options = c("striped", "hover")) %>% column_spec(1, bold = T,  background="#E0E0E0") %>% row_spec(0, bold = T, background="#E0E0E0")

remove(tb_resumen1, Partidos, Divisiones)
```

## Goles Realizados por los Equipos Jugando como Local

* Hay un total de 123.404 datos o registros.
* La moda (número que más se repite) es 1 gol.
* El promedio de goles anotados de los equipos jugando como local es de 1,48.
* La desviación estándar nos dice que hay una dispersión de los datos de 1,25 aproximadamente.
* El valor mínimo presentado en goles anotados de los locales es de 0.
* Dado que el cuartil 1 es de 1, nos dice que el 25% de los datos son menores o igual a 1 gol por parte de los equipos locales.
* Dado que la mediana es de 1, nos dice que el 50% de los datos son menores o igual a 1 gol por parte de los equipos locales.
* Dado que el cuartil 3 es de 2, nos dice que el 25% de los datos son mayores a 2 goles por parte de los equipos locales.
* El valor máximo presentado en goles anotados de los locales es de 10.
* Obtenemos un coeficiente de variación de 84,61%, lo que nos dice que los goles locales presentan una variabilidad alta.

## Goles Realizados por los Equipos Jugando como Visitantes

* Hay un total de 123.404 datos o registros.
* La moda (número que más se repite) es 1 gol.
* El promedio de goles anotados de los equipos jugando como visitante es de 1,14.
* La desviación estándar nos dice que hay una dispersión de los datos de 1,11 aproximadamente.
* El valor mínimo presentado en goles anotados de los visitantes es de 0.
* Dado que el cuartil 1 es de 0, nos dice que el 25% de los datos son menores o igual a 0 goles por parte de los equipos visitantes.
* Dado que la mediana es de 1, nos dice que el 50% de los datos son mayores o igual a 1 gol por parte de los equipos visitantes.
* Dado que el cuartil 3 es de 2, nos dice que el 25% de los datos son mayores o iguales a 2 goles por parte de los equipos visitantes.
* El valor máximo presentado en goles anotados de los visitantes es de 13.
* Obtenemos un coeficiente de variación de 97,14%, lo que nos dice que los goles locales presentan una variabilidad alta.

\pagebreak
# ¿El ascenso o descenso de liga de un equipo sentencia su lugar en la tabla de posiciones?

Se procede a tomar una muestra conformada por equipos descendidos en la temporada 2014-15 de la Premier League de inglaterra, y los ascendidos en la temporada 2014-15 de la Champioship de inglaterra.  

* Los equipos descendidos fueron "Burnley","Hull" y el "QPR".  
* Los equipos ascendidos fueron "Bournemouth",el "Norwich" y el "Watford".

## Porcentaje de puntos obtenidos por los equipos en cada una de sus temporadas

```{r, echo=FALSE}
Primera_Segunda_2 %>% select(c(1, 4, 6, 5)) %>% kable() %>% kable_styling(bootstrap_options = c("striped", "hover")) %>% column_spec(1, bold = T,  background="#E0E0E0") %>% row_spec(0, bold = T, background="#E0E0E0")

remove(Primera_Segunda_2)
```

Es inevitable notar que en la temporada que cada equipo jugo en segunda division su eficacia en la obtencion de puntos fue muy superior en comparacion con su temporada en primera.

Pero, ¿esto implica que los descendidos dominaran la segunda division y los ascendidos cayeran en puestos de descenso nuevamente?

## Puntos acumulados de los equipos descendidos a lo largo de la temporada

Retomamos a los equipos "Burnley","Hull" y el "QPR", en su temporada de segunda division y los comparamos con equipos que ya formaban parte de ella.

```{r, echo=FALSE}
ggplot(Datos1, aes(x=total_puntos, y=Equipo, fill=VS)) + geom_col(color="black") + labs(x = "Puntos Acumulados") + ggtitle("Comparativa de puntos entre los equipos de Segunda division") + theme(plot.title=element_text(hjust = 0.5, size=11)) + geom_text(aes(label=total_puntos), vjust=0, hjust=-0.3, size=3) + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD")) + theme_bw()

remove(Datos1)
```
Como se puede apreciar, de los equipos descendidos, el Burnley  se llevo la delantera en puntos y por cierto se corono campeon en dicha temporada, su perseguidor inmediato fue el Brighton, diferenciandose solo por dos puntos y se trata de un equipo que ya formaba parte de dicha division.Como contraste, tenemos al QPR que a pesar de venir de jugar una temporada en la elite del futbol ingles apenas logro obtener 54 puntos de los 138 posibles, con este resultado no logro entrar si quiera en los 10 mejores del torneo.

## Puntos acumulados por los equipos ascendidos a lo largo de la temporada

Retomamos a los equipos "Bournemouth","Norwich" y el "Watford",en su temporada de primera division y los comparamos con equipos que ya formaban parte de ella.


```{r, echo=FALSE}
ggplot(Datos2, aes(x=total_puntos, y=Equipo, fill=VS)) + geom_col(color="black") + labs(x = "Puntos Acumulados") + ggtitle("Comparativa de puntos entre los equipos de primera division") + theme(plot.title=element_text(hjust = 0.5, size=11)) + geom_text(aes(label=total_puntos), vjust=0, hjust=-0.3, size=3) + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD")) + theme_bw()

remove(Datos2, Primera_Segunda)
```

Podemos apreciar que de los equipos ascendidos, el peor desempeño lo obtuvo el Norwich con 32 puntos de 114 posibles, cayendo nuevamente en puestos de descenso.El Watford por otra parte tuvo un desempeño interesante logrando obtener 45 puntos en la temporada y posicionandose por encima 6 equipos que ya formaban parte de dicha division, entre ellos el Newcastle, el Everton y el Crystal Palace. Para esta temporada el Watford logro posicionarse de doceavo en la Premier League.

## Conlusión 

Los resultados recien presentados nos indican el nivel de competitividad que poseen ambas ligas, por su puesto, la primera division es mucho mas complicada, pero eso no implica que equipos recien ascendidos hagan una muy mala temporada, o que los descendidos la tengan facil en la segundo division.

\pagebreak
# ¿Los Equipos Tienden a Ganar más Cuando Juegan en sus Estadios Locales?

 Se procede a evaluar los resultados de todos los juegos de la BBDD donde "Athetic Club" y el "Manchester City" juegan de local y serán comparados con los resultados donde juegan de visitante, de esta manera se visualizará en que posición se han llevado más victorias.
 
 También es importante mencionar que son todos sus partidos en sus ligas desde la temporada 2005-06 hasta la 2020-21.

## Distribución de Frecuencias de los Resultados de los Partidos - Athetic Club Bilbao

 A continuación un histograma de frecuencias que nos indican los resultados de los partidos totales del Athletic Club en La Liga.

```{r Frec_Athletic_col, echo=FALSE, warning=FALSE, message=FALSE}
ath_plot <- v_ath %>% group_by(Lugar, Ganador) %>% summarise(Total= n())%>% 
mutate(Porcentaje=round(Total/sum(Total)*100, 1), Proporcion=round(Total/sum(Total), 2))

ggplot(ath_plot, aes(x=Lugar, y=Total, fill=Ganador)) + geom_col(position="dodge", colour="black") + labs(y="Frecuencia") + ggtitle("Registro de Partidos - Athletic Club de Bilbao") + theme_bw() + ylim(c(0,160)) + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD")) + theme(plot.title=element_text(hjust = 0.5, size=11)) +
geom_text(aes(label=paste0(Total," ", "", "(", Porcentaje, "%", ")")),
         vjust=-0.5, 
         color="black", 
         hjust=0.5,
         position = position_dodge(0.9), 
         size=3.0)
```

 Podemos observar en la gráfica que Athletic jugando de local: \
- Ha ganado el 47,7% de sus partidos. \
- Ha perdido el 26,3% de sus partidos. \
- Ha empatado el 26% de sus partidos. 

 Por otra parte, Athletic jugando como visitante: \
- Ha ganado el 25,3% de sus partidos. \
- Ha perdido el 47,4% de sus partidos. \
- Ha empatado el 27,3% de sus partidos.

## Distribución de Frecuencias de los Resultados de los Partidos - Manchester City

 A continuación un histograma de frecuencias que nos indican los resultados de los partidos totales del Manchester City en la Premier Ligue.

```{r Frec_Mancherster_col, echo=FALSE, warning=FALSE, message=FALSE}
man_plot <- v_man %>% group_by(Lugar, Ganador) %>% summarise(Total= n()) %>% 
mutate(Porcentaje = round(Total/sum(Total)*100, 1), Proporcion=round(Total/sum(Total), 2))

ggplot(man_plot, aes(x=Lugar, y=Total, fill=Ganador)) + geom_col(position="dodge",colour="black") + labs(y="Frecuencia") + ggtitle("Registro de Partidos - Manchester City") + theme_bw() + ylim(c(0,220)) + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD")) + theme(plot.title=element_text(hjust = 0.5, size=11)) + geom_text(aes(label=paste0(Total," ", "", "(", Porcentaje, "%", ")")),
         vjust=-0.5, 
         color="black", 
         hjust=0.5,
         position = position_dodge(0.9), 
         size=3.0)
```

 Podemos observar en la gráfica que el Manchester City jugando de local: \
- Ha ganado el 69,4% de sus partidos. \
- Ha perdido el 16,5% de sus partidos. \
- Ha empatado el 14,1% de sus partidos. 

 Por otra parte, el Manchester City jugando como visitante: \
- Ha ganado el 47% de sus partidos. \
- Ha perdido el 31,9% de sus partidos.\
- Ha empatado el 21,1% de sus partidos. 

### Distribución de Densidad de los Resultados de los Partidos de los Equipos - Athetic y Manchester

 Adentrándonos en estas frecuencias y porcentajes, podemos estudiar su composición de proporciones, lo que nos ayuda a medir en una misma escala todo, y notar a simple vista lo que ocurre en comparación entre los equipos.

```{r Dens_ath-man_col, echo=FALSE}
g1 <- ggplot(ath_plot, aes (x=Lugar, y=Proporcion, fill=Ganador)) + geom_col(color="black", position="fill") + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD")) + theme_bw() + labs(y="Proporciones") + ggtitle("Densidad de los Resultados \n(Athletic Club)") + theme(plot.title=element_text(size=11))

g2 <- ggplot(man_plot, aes (x=Lugar, y=Proporcion, fill=Ganador)) + geom_col(color="black", position="fill") + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD")) + theme_bw() + labs(y="Proporciones") + ggtitle("Densidad de los Resultados \n(Manchester City)") + theme(plot.title=element_text(size=11))

plot_grid(g1, g2, nrow=1)

remove(v_ath, v_man, ath_plot, man_plot, g1, g2)
```

 Se puede apreciar que el Athletic Club tiene un mejor rendimiento si juega como local, con una mayor proporción de victorias acumuladas delante las otras entre las temporadas 2005-06 a la la 2020-21.
 
 Al igual que el equipo anterior, el Manchester City tiene una mayor tasa de victorias jugando como local, pero también se aprecia que a su vez ha ganado la mayor parte de la proporción de partidos jugando como visitante. Entonces se puede decir que es un destacable equipo de la premier ligue, pero tiene un mejor rendimiento jugando de local.
 
 Como dato, el que un equipo tenga muchas victorias jugando de local puede tener más detalles a considerar, como el sentido de comodidad por jugar en su "hogar" del equipo, una mayor cantidad de afición apoyandolos en los asientos a comparación del equipo rival, entre otros.

## Conclusión del Rendimiento por los Estadios Locales

 Si, los equipos jugando de manera local suelen tener una ventaja de victoria delante su rival. Presentan una mayor proporción de ganar delante los otros dos posibles resultados (empatar o perder) en la muestra, y por regularidad estadística, si se toma una muestra de un espacio muestral, se va a comportar igual al espacio muestra.
 
 Se respalda esta información con el artículo que hizo Fatima Juan Belmonte, una reportera de prensa deportiva.  
 Mediante hechos con respecto a un equipo español, demostró la importancia de la afición a su equipo, la fuente de motivación que son para el mismo e incluso su relevancia a la hora de nuevos fichajes.

 También Carlos Cueva, profesor de Economía de la Universidad de Alicante, realizó un estudio sobre 41 ligas (antes y después de que comenzó la pandemia), y comprobó que la afición local genera una presión al equipo visitante, recopilando resultados, se notó que sin la afición de ninguna de las partes, los equipos visitantes aumenta su tasa de victoria hasta un 12% por temporada, pero nunca es mayor a la tasa de victorias local.

\pagebreak
# ¿Cuál fué el Efecto en la Consistencia Reflejada en la Cantidad de Goles en las Ligas Tras la Implementación del Video Assistant Referee (VAR)?

 Se procede a evaluar los goles anotados por 3 equipos de las ligas “Bundesliga” y “Laliga”, y comparar sus cambios una temporada antes y después la implementación oficial del VAR en sus respectivas divisiones de 1era. Un dato importante antes de continuar, es que se tomaron 2 equipo regulares de las ligas y 1 equipo por trayectoria muy bueno de cada liga.

 Los equipos a evaluar de la Bundesliga en las temporadas 2016-17 y 2017-18 son: Eintracht Fráncfort, Bayer 04 Leverkusen, SC Friburgo.

 Los equipos a evaluar de Laliga en las temporadas 2017-18 y 2018-19 son: FC Barcelona, Sevilla FC, Athletic Club.

## Dispersión de Goles - Bundesliga

 A continuación gráficos de caja y bigote que ayuda a visualizar la dispersión de los goles anotados por los equipos de la Bundesliga en estudio.

```{r Disp_bundes_boxplot, echo=FALSE, warning=FALSE}
g3 <- ggplot(var_bundes_antes, aes(x=Equipo, y=Goles_Pro, fill=Equipo)) + geom_jitter() + geom_boxplot() + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD"))+ labs(x="Equipos", y="Goles Anotados") + theme_bw() + ylim(c(0,6)) + theme(legend.position = "none") 

g4 <- ggplot(var_bundes_despues, aes(x=Equipo, y=Goles_Pro, fill=Equipo)) + geom_jitter() + geom_boxplot() + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD"))+ labs(x="Equipos", y="Goles Anotados") + theme_bw() + ylim(c(0,6)) + theme(legend.position = "none") 

plot_grid(g3, g4, nrow=1)

remove(g3, g4)
```

```{r Resumen_esta Dist_bundes, echo=FALSE}
tb_resumen2 <- var_bundes_antes %>% group_by(Equipo) %>% descr(stats = c("min", "q1", "med", "q3", "max", "mean", "sd"), transpose = TRUE) %>% tb(order = 3) %>% rename(Min=min, Q1=q1, Med=med, Q3=q3, Max=max, "Media(antes)"=mean, "Desv-Std(antes)"=sd) %>% mutate(across(c(8,9), ~ round(., 2))) %>% select(c(2, 3, 4, 5, 6, 7, 8, 9))

tb_resumen3 <- var_bundes_despues %>% group_by(Equipo) %>% descr(stats = c("mean", "sd"), transpose = TRUE) %>% tb(order = 3) %>% rename("Media(después)"=mean, "Desv-Std(después)"=sd) %>% mutate(across(c(3,4), ~ round(., 2))) %>% select(c(3, 4))

tb_resumen2 %>% mutate(tb_resumen3) %>% kable() %>% kable_styling(bootstrap_options = c("striped", "hover"), font_size = 8) %>% column_spec(1, bold = T,  background="#E0E0E0") %>% row_spec(0, bold = T, background="#E0E0E0")

remove(var_bundes_antes, var_bundes_despues, tb_resumen2, tb_resumen3)
```

 Específicamente hablando de la dispersión de los datos, independientemente de su mejoría o desmejoría a nivel de goles. Notemos que en estos equipos hubieron 2 de 3 (Friburgo y el Leverkusen) que aumentaron su desviación estándar con respecto a su media.  

* En el caso de Friburgo en pocas palabras, su concentración de datos del 50% bajó dos unidades, pasó a encontrarse entre los dos más bajos (0 y 1 goles). En definitiva empeoró su capacidad goleadora.
* En el caso de Leverkusen, su concentración de datos del 50% se mantuvo entre 1 y 2 goles, pero su mediana aumentó ligeramente. 

 Con respecto al otro equipo (Eintracht), apenas y hubo una muy ligera disminución de su desviación estándar con respecto a su media.

 Lo curioso de este caso es que 2 de los 3 equipos (Eintracht y el Leverkusen) evaluados en términos de goles han aumentado (en goles) su rango de concentración de datos del 50% y su media, se dice que después de la inclusión del VAR les fue mejor anotando goles “válidos”.  
 Por otra parte el otro equipo (Friburgo) se vió afectado y disminuyó estas estadísticas, tras la inclusión del VAR le fue peor anotando goles “válidos”.

## Dispersión de Goles - Laliga

 A continuación gráficos de caja y bigote que ayuda a visualizar la dispersión de los goles anotados por los equipos de Laliga en estudio.

```{r Disp_laliga_boxplot, echo=FALSE, warning=FALSE}
g5 <- ggplot(var_laliga_antes, aes(x=Equipo, y=Goles_Pro, fill=Equipo)) + geom_jitter() + geom_boxplot() + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD"))+ labs(x="Equipos", y="Goles Anotados") + theme_bw() + ylim(c(0,8)) + theme(legend.position = "none") 

g6 <- ggplot(var_laliga_despues, aes(x=Equipo, y=Goles_Pro, fill=Equipo)) + geom_jitter() + geom_boxplot() + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD")) + labs(x="Equipos", y="Goles Anotados") + theme_bw() + ylim(c(0,8)) + theme(legend.position = "none")

plot_grid(g5, g6, nrow=1)

remove(g5, g6)
```
\pagebreak

```{r Resumen_esta Dist_laliga, echo=FALSE}
tb_resumen4 <- var_laliga_antes %>% group_by(Equipo) %>% descr(stats = c("min", "q1", "med", "q3", "max", "mean", "sd"), transpose = TRUE) %>% tb(order = 3) %>% rename(Min=min, Q1=q1, Med=med, Q3=q3, Max=max, "Media(antes)"=mean, "Desv-Std(antes)"=sd) %>% mutate(across(c(8,9), ~ round(., 2)))%>% select(c(2, 3, 4, 5, 6, 7, 8, 9))

tb_resumen5 <- var_laliga_despues %>% group_by(Equipo) %>% descr(stats = c("mean", "sd"), transpose = TRUE) %>% tb(order = 3) %>% rename("Media(después)"=mean, "Desv-Std(después)"=sd) %>% mutate(across(c(3,4), ~ round(., 2))) %>% select(c(3, 4))

tb_resumen4 %>% mutate(tb_resumen5) %>% kable() %>% kable_styling(bootstrap_options = c("striped", "hover"), font_size = 8) %>% column_spec(1, bold = T,  background="#E0E0E0") %>% row_spec(0, bold = T, background="#E0E0E0")

remove(var_laliga_antes, var_laliga_despues, tb_resumen4, tb_resumen5)
```

 Podemos notar que un equipo (Ath Bilbao) se mantuvo por completo igual, la realidad tras esto, es que apenas y cambió su orden univariante. Mientras que los otros 2 equipos (Barcelona y el Sevilla) aumentaron su rango de concentración de datos una unidad menos, y sus medias por separado, disminuyeron para uno y aumentó para otro. Acá es donde entra la dispersión nos da respuestas claras.

Analizando la dispersión de los datos, independientemente de su mejoría o desmejoría a nivel de goles. Estos dos equipos (Barcelona y el Sevilla) sí tuvieron tras la inclusión del VAR un aumento de su desviación estándar.

* En el Sevilla su concentración del 50% de los datos ahora se encuentra en entre los 2 valores más bajos, pero tiene una cantidad considerable de datos lejanos positivamente a esta concentración, por eso su media y desviación estándar aumentaron.

* El Barcelona por aumentar su rango de concentración de los datos del 50% una unidad hacia abajo, hizo que su media disminuyera, además, de por si su media era muy alta. Pero su desviación se ve superada porque tiene un dato atípico muy alto en 8 goles.


## Conclusión Sobre la Consistencia con la Introducción del VAR

 Casi todos los equipos vieron un aumento de su desviación típica con respecto a su media hablando de goles, es un fenómeno que viene de mano a que en la mayoría de los casos su rango del 50% central de los datos disminuyó una unidad. Esto nos dice que los equipos que solían anotar “muchos” goles en el marcador bajaron esa cantidad.

Por otro lado equipos que no son de anotar muchos goles mantuvieron esa dispersión con respecto a su media goleadora, lo que nos dice que no se vieron afectados por ese lado, o en el mejor o peor de sus casos estabilizaron ese rango de concentración del 50% de goles que suelen anotar a uno más o menos.

\pagebreak
# ¿Puede Distinguir un Cambio de Entrenador y/o Jugadores del Equipo para un Dominio del Marcador en su Mayoría de Juegos?

 En este caso se estudiarán todos los partidos de “Athletic Club de Bilbao” y “RC Celta de Vigo”, 2 equipos de Laliga en su primera división, en sus temporadas 2017-18 y 2018-19.  
 Además, se realizó una investigación fuera de la BBDD en la página “Transfer Markt”,  sobre el cambio de plantilla y entrenador entre el tiempo de transición de estas 2 temporadas, y el algunos casos, poco después de empezar la 2018-19.

Los resultados obtenidos fueron:

![cambio de Entrenadores]("C:\\Users\\guill\\Documents\\Trabajos\\Fútbol_TF - Repo\\Proyecto - Fútbol\\Imagenes Extras\\Cambio de Entrenadores 2018-19.jpg"){width='460px'}
 
Cambios de plantilla Athletic:  
- Salió 1 portero, entraron 2. \
- Salieron 6 defensas, entraron 3. \
- Salieron 3 centros, entraron 2. \
- Salieron 2 delanteros, entraron 4. \
- El equipo pasó de 33 integrantes a 32. 

Cambios de plantilla Celta:  
- Salieron 2 porteros. \
- Salieron 5 defensas, entraron 7. \
- Salieron 3 centros, entraron 4. \
- Salieron 5 delanteros, entraron 2. \
- El equipo pasó de 32 integrantes a 30.

 El punto de este apartado es ver cómo les fue a nivel de victorias, derrotas y empates en la ejecución de estas temporadas y hacer la comparación entre ellas, todo para ver si llevaron a un mejor dominio del macardor en  general.

## Partidos del Athletic Club de Bilbao

```{r Waflle Ath Bilbao_1, echo=FALSE}
g7 <-  ggplot(p_ath_a, aes(fill=Resultado, values=Total_Resultados)) + geom_waffle(n_rows=7, size=0.3, colour = "white") + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD")) + ggtitle("Ath Club de Bilbao (2017-18)")+ coord_equal() + theme_bw()

g8 <-  ggplot(p_ath_d, aes(fill=Resultado, values=Total_Resultados)) + geom_waffle(n_rows=7, size=0.3, colour = "white") + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD")) + ggtitle("Ath Club de Bilbao (2018-19)") + coord_equal() + theme_bw()

plot_grid(g7, g8, nrow=1)

remove(p_ath_a, p_ath_d, g7, g8)
```

## Partidos del RC Celta de Vigo

```{r Waflle Ath Bilbao_2, echo=FALSE}
g9 <-  ggplot(p_celta_a, aes(fill=Resultado, values=Total_Resultados)) + geom_waffle(n_rows=7, size=0.3, colour = "white") + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD")) + ggtitle("RC Celta de Vigo (2017-18)")+ coord_equal() + theme_bw()

g10 <-  ggplot(p_celta_d, aes(fill=Resultado, values=Total_Resultados)) + geom_waffle(n_rows=7, size=0.3, colour = "white") + scale_fill_manual(values=c("#CE93D8", "#7B1FA2", "#9C27BD")) + ggtitle("RC Celta de Vigo (2018-19)") + coord_equal() + theme_bw()

plot_grid(g9, g10, nrow=1)

remove(p_celta_a, p_celta_d, g9, g10)
```

## Conclusión del Efecto de los Cambios de Entrenador y/o Jugadores del Equipo 

\pagebreak
# Bibliografía

* Belmonte, F. (2017, noviembre 19). La importancia de la afición. VAVEL. Recuperado de https://www.vavel.com/es/futbol/2017/11/19/rayo-vallecano/849777-la-importancia-de-la-aficion.html

* Guerrero, S. (2021, febrero 18). ¿Cuál es la influencia de las hinchadas locales en el fútbol?. PRIMICIAS. Recuperado de https://www.primicias.ec/noticias/jugada/peso-influencia-hinchada-equipos-locales-estadios-futbol/

* CAMBIOS DE ENTRENADORES DURANTE LA TEMPORADA. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/laliga/trainerwechsel/wettbewerb/ES1/plus/?saison_id=2018

* CAMBIOS DE ENTRENADORES DURANTE LA TEMPORADA. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/laliga/trainerwechsel/wettbewerb/ES1/plus/?saison_id=2017

* IMPACTO DE ENTRENADOR. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/laliga/trainereffekt/wettbewerb/ES1/plus/?saison_id=2018&spiele=15

* IMPACTO DE ENTRENADOR. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/laliga/trainereffekt/wettbewerb/ES1/plus/?saison_id=2017&spiele=15

* EQUIPO ATHLETIC CLUB - TEMPORADA 18/19. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/athletic-club/kader/verein/621/plus/0/galerie/0?saison_id=2018

* EQUIPO ATHLETIC CLUB - TEMPORADA 17/18. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/athletic-club/kader/verein/621/plus/0/galerie/0?saison_id=2017

* EQUIPO RC CELTA DE VIGO - TEMPORADA 18/19. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/rc-celta-de-vigo/kader/verein/940/plus/0/galerie/0?saison_id=2018

* EQUIPO RC CELTA DE VIGO - TEMPORADA 17/18. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/rc-celta-de-vigo/kader/verein/940/plus/0/galerie/0?saison_id=2017
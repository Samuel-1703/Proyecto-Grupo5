---
title: "Por definir xd"
author: "Contreras Valeria, Guillén David, Zamora Samuel, Morales Andrés"
date: "Junio del 2024"
output: 
  pdf_document:
    toc: TRUE
    toc_depth: 2
fontside: 11pt
lang: Es-es
---

```{r Bliblioteca, include=FALSE}
#Paquetes a utilizar
library(tinytex)
library(DBI)
library(RSQLite)
library(tidyverse)
library(kableExtra)

#BBDD
futbol <- dbConnect(SQLite(), dbname = "Fútbol Europeo BBDD.sqlite")

#Funciones
moda<- function(x) {
   return(as.numeric(names(which.max(table(x)))))
}

#Tablas de la BBDD
Divisiones <- dbGetQuery(futbol, "SELECT * FROM Divisiones")
Partidos <- dbGetQuery(futbol, "SELECT * FROM Partidos")

#variables
v_ath <- dbGetQuery(futbol,
"SELECT * FROM (SELECT Id_Partidos, Team_Local AS Equipo, Ganador
				FROM Partidos 
					WHERE Cod_Division='SP1' AND Team_Local='Ath Bilbao'
				UNION
			   SELECT * FROM Obj_1)
	ORDER BY Ganador")
v_ath <- v_ath %>% mutate(Lugar = case_when(Equipo == "Ath Bilbao" ~ "Local", Equipo == "Ath Bilbao." ~ "Visitante")) %>% mutate(Ganador = recode(Ganador, "E" = "Empate", "L" = "Local", "V" = "Visitante"))

v_man <- dbGetQuery(futbol,
"SELECT * FROM (SELECT Id_Partidos, Team_Local AS Equipo, Ganador
				FROM Partidos 
					WHERE Cod_Division='E0' AND Team_Local='Man City'
				UNION
			   SELECT * FROM Obj_12)
	ORDER BY Ganador")
v_man <- v_man %>% mutate(Lugar = case_when(Equipo == "Man City" ~ "Local", Equipo == "Man City." ~ "Visitante")) %>% mutate(Ganador = recode(Ganador, "E" = "Empate", "L" = "Local", "V" = "Visitante"))

#Para ultimo objetivo
#goles_athletic_local <- dbGetQuery(futbol, "SELECT * FROM laliga_2017_2018
#	WHERE Team_Local='Ath Bilbao'")
remove(Divisiones)
```

\pagebreak
# Planteamiento del Problema

 El fútbol es un deporte a nivel profesional alto de once jugadores por equipo, involucra la cooperación mutua del equipo y se sabe que es un deporte que conlleva el contacto. Estos equipos tienen la misión de trasladar un balón utilizando cualquier parte del cuerpo exceptuando brazos y manos con la finalidad de encajarlo dentro de la portería o arco del conjunto rival, acción que se denomina gol. El equipo con más goles durante un partido de 90 minutos ganará el encuentro.

 Pueden existir partidos en los que un equipo sea tácticamente muy superior al rival, o que cuente con jugadores de mejor calidad. Al final del partido puede influir en que dominen en estadísticas como mayor posesión de balón, mayor precisión en los pases, más disparos al arco rival, mayor cantidad de tiros libres y todo lo que pueda favorecer a un equipo para demostrar que es superior, pero lo único que sentencia un partido son los goles, y ganar como en cualquier deporte es la única manera de avanzar en un torneo o competición.

 Ya que marcar goles para cualquier equipo es una necesidad, resulta interesante develar qué factores pueden influir en los conjuntos para que aumente o disminuya su capacidad goleadora.

 Se tiene en estudio una base de datos relacionados a algunas ligas del fútbol europeo, entre ellas las 5 más importantes del mundo según la plataforma Global Football Rankings, que utiliza análisis de datos para evaluar y clasificar las ligas de fútbol en todo el mundo, esta plataforma concluye que en este top se encuentran la Premier League (Inglaterra), La Bundesliga (Alemania), LaLiga (España), Serie A (Italia) y Ligue 1 (Francia).  
 La base de datos cuenta con variables como los goles anotados por los equipos de cada liga tanto de local como de visitante, a lo largo de las temporadas que transcurrieron desde el año 2006 hasta el año 2021, y partiendo de dicha información surgen las interrogantes que se presentan a continuación. 

 El objetivo del presente trabajo estadístico es exponer y demostrar algunos factores determinantes que tienen influencia en la cantidad de goles y victorias que se pueden llevar un equipo partido a partido. Todo esto en base a la secuencia de partidos de las ligas y divisiones que están registradas en la BBDD.  
 Trabajaremos con unas muestras de la BBDD la cual consta principalmente del equipo "Athletic Club" de Bilbao que juega en la primera división de “La Liga”, el campeonato nacional de España. Mientras avanzamos con el desarrollo del trabajo, también se expondrán otros equipos aleatoriamente a las pruebas del objetivo junto al principal anteriormente mencionado.

## Interrogantes/Objetivos

1) ¿Los equipos tienden a ganar más cuando juegan en sus estadios locales?

2) ¿Influyeron los partidos sin público durante la pandemia en la capacidad de anotar goles por parte de los equipos que jugaron de visitante?

3) ¿Tuvo influencia la implementación del Video Assistant Referee (VAR), en la cantidad de goles que ofrecían las respectivas ligas?

4) ¿Puede distinguir un cambio de entrenador y/o jugadores del equipo para un dominio del marcador en su mayoría de juegos?

# Resumen Descriptivo de la BBDD



# ¿Los equipos tienden a ganar más cuando juegan en sus estadios locales?

 Se procede a evaluar los resultados de todos los juegos de la BBDD donde "Athetic Club" y el "Manchester City" juegan de local y serán comparados con los resultados donde juegan de visitante. De esta manera se visualizará en que posición se ha llevado más victorias
 
 También es importante mencionar que son todos sus partidos en sus ligas desde la temporada 2005-06 hasta la 2020-21.

## Distribución de Frecuencias de los Resultados de los Partidos - Athetic Club Bilbao

 A continuanción un histograma de frecuencias que nos indican los resultados de los partidos totales del **Athletic Club** en La Liga.

```{r Frec_Athletic_col, echo=FALSE, warning=FALSE}
ath_plot <- v_ath %>% group_by(Lugar, Ganador) %>% summarise(Total= n()) %>% 
mutate(Porcentaje = round(Total/sum(Total)*100, 1))

ggplot(ath_plot, aes(x=Lugar, y=Total, fill=Ganador)) + geom_col(position="dodge",colour="black") + labs(y="Frecuencia") + ggtitle("Registro de Partidos - Athletic Club de Bilbao") + theme_test() + ylim(c(0,160)) + scale_fill_manual(values=c("#CE93D8", "#9C27BD", "#BA68CB")) + 
geom_text(aes(label=paste0(Total," ", "", "(", Porcentaje, "%", ")")),
         vjust=-0.4, 
         color="black", 
         hjust=0.5,
         position = position_dodge(0.9), 
         size=4.0)

remove(ath_plot)
```

## Distribución de Frecuencias de los Resultados de los Partidos - Manchester City

 A continuanción un histograma de frecuencias que nos indican los resultados de los partidos totales del **Manchester City** en la Premier Ligue.

```{r Frec_Mancherster_col, echo=FALSE, warning=FALSE}
man_plot <- v_man %>% group_by(Lugar, Ganador) %>% summarise(Total= n()) %>% 
mutate(Porcentaje = round(Total/sum(Total)*100, 1))

ggplot(man_plot, aes(x=Lugar, y=Total, fill=Ganador)) + geom_col(position="dodge",colour="black") + labs(y="Frecuencia") + ggtitle("Registro de Partidos - Manchester City") + theme_test() + ylim(c(0,220)) + scale_fill_manual(values=c("#CE93D8", "#9C27BD", "#BA68CB")) + 
geom_text(aes(label=paste0(Total," ", "", "(", Porcentaje, "%", ")")),
         vjust=-0.4, 
         color="black", 
         hjust=0.5,
         position = position_dodge(0.9), 
         size=4.0)

remove(man_plot)
```

## Distrubición de Densidad de los Resultados de los Partidos de los Equipos

# Bibliografía

* https://www.transfermarkt.es/laliga/trainerwechsel/wettbewerb/ES1/plus/?saison_id=2018

* https://www.transfermarkt.es/laliga/trainerwechsel/wettbewerb/ES1/plus/?saison_id=2017

* https://www.transfermarkt.es/laliga/trainereffekt/wettbewerb/ES1/plus/?saison_id=2018&spiele=15

* https://www.transfermarkt.es/laliga/trainereffekt/wettbewerb/ES1/plus/?saison_id=2017&spiele=15

* https://www.transfermarkt.es/athletic-club/kader/verein/621/plus/0/galerie/0?saison_id=2018

* https://www.transfermarkt.es/athletic-club/kader/verein/621/plus/0/galerie/0?saison_id=2017

* https://www.transfermarkt.es/rc-celta-de-vigo/kader/verein/940/plus/0/galerie/0?saison_id=2018

* https://www.transfermarkt.es/rc-celta-de-vigo/kader/verein/940/plus/0/galerie/0?saison_id=2017
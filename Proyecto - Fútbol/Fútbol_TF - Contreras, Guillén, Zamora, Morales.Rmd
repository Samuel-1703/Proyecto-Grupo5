---
title: "Por definir xd"
author: "Contreras Valeria, Guillén David, Zamora Samuel, Morales Andrés"
date: "Junio del 2024"
output: 
  pdf_document:
    toc: TRUE
    toc_depth: 3
fontside: 11pt
lang: Es-es
---

```{r Bliblioteca, include=FALSE}
#Paquetes a utilizar
library(tinytex)
library(DBI)
library(RSQLite)
library(tidyverse)
library(cowplot)
library(summarytools)
library(kableExtra)

#BBDD
futbol <- dbConnect(SQLite(), dbname = "Fútbol Europeo BBDD.sqlite")

#Funciones
moda<- function(x) {
   return(as.numeric(names(which.max(table(x)))))
}

#Tablas de la BBDD
Divisiones <- dbGetQuery(futbol, "SELECT * FROM Divisiones")
Partidos <- dbGetQuery(futbol, "SELECT * FROM Partidos")

#Variables
v_ath <- dbGetQuery(futbol,
"SELECT * FROM (SELECT Id_Partidos, Team_Local AS Equipo, Ganador
				FROM Partidos 
					WHERE Cod_Division='SP1' AND Team_Local='Ath Bilbao'
				UNION
			   SELECT * FROM Obj_1)
	ORDER BY Ganador")
v_ath <- v_ath %>% mutate(Lugar = case_when(Equipo == "Ath Bilbao" ~ "Local", Equipo == "Ath Bilbao." ~ "Visitante")) %>% mutate(Ganador = recode(Ganador, "E" = "Empate", "L" = "Local", "V" = "Visitante"))

v_man <- dbGetQuery(futbol,
"SELECT * FROM (SELECT Id_Partidos, Team_Local AS Equipo, Ganador
				FROM Partidos 
					WHERE Cod_Division='E0' AND Team_Local='Man City'
				UNION
			   SELECT * FROM Obj_12)
	ORDER BY Ganador")
v_man <- v_man %>% mutate(Lugar = case_when(Equipo == "Man City" ~ "Local", Equipo == "Man City." ~ "Visitante")) %>% mutate(Ganador = recode(Ganador, "E" = "Empate", "L" = "Local", "V" = "Visitante"))

#Para ultimo objetivo
#goles_athletic_local <- dbGetQuery(futbol, "SELECT * FROM laliga_2017_2018
#	WHERE Team_Local='Ath Bilbao'")
remove(Divisiones)
```

\pagebreak
# Planteamiento del Problema

 El fútbol es un deporte a nivel profesional alto de once jugadores por equipo, involucra la cooperación mutua del equipo y se sabe que es un deporte que conlleva el contacto. Estos equipos tienen la misión de trasladar un balón utilizando cualquier parte del cuerpo exceptuando brazos y manos con la finalidad de encajarlo dentro de la portería o arco del conjunto rival, acción que se denomina gol. El equipo con más goles durante un partido de 90 minutos ganará el encuentro.

 Pueden existir partidos en los que un equipo sea tácticamente muy superior al rival, o que cuente con jugadores de mejor calidad. Al final del partido puede influir en que dominen en estadísticas como mayor posesión de balón, mayor precisión en los pases, más disparos al arco rival, mayor cantidad de tiros libres y todo lo que pueda favorecer a un equipo para demostrar que es superior, pero lo único que sentencia un partido son los goles, y ganar como en cualquier deporte es la única manera de avanzar en un torneo o competición.

 Ya que marcar goles para cualquier equipo es una necesidad, resulta interesante develar qué factores pueden influir en los conjuntos para que aumente o disminuya su capacidad goleadora.

 Se tiene en estudio una base de datos relacionados a algunas ligas del fútbol europeo, entre ellas las 5 más importantes del mundo según la plataforma Global Football Rankings, que utiliza análisis de datos para evaluar y clasificar las ligas de fútbol en todo el mundo, esta plataforma concluye que en este top se encuentran la Premier League (Inglaterra), La Bundesliga (Alemania), LaLiga (España), Serie A (Italia) y Ligue 1 (Francia).  
 La base de datos cuenta con variables como los goles anotados por los equipos de cada liga tanto de local como de visitante, a lo largo de las temporadas que transcurrieron desde el año 2006 hasta el año 2021, y partiendo de dicha información surgen las interrogantes que se presentan a continuación. 

 El objetivo del presente trabajo estadístico es exponer y demostrar algunos factores determinantes que tienen influencia en la cantidad de goles y victorias que se pueden llevar un equipo partido a partido. Todo esto en base a la secuencia de partidos de las ligas y divisiones que están registradas en la BBDD.  
 Trabajaremos con unas muestras de la BBDD la cual consta principalmente del equipo "Athletic Club" de Bilbao que juega en la primera división de “La Liga”, el campeonato nacional de España. Mientras avanzamos con el desarrollo del trabajo, también se expondrán otros equipos aleatorios a las pruebas del objetivo junto al principal anteriormente mencionado.


## Interrogantes/Objetivos

1) ¿Los equipos tienden a ganar más cuando juegan en sus estadios locales?

2) ¿Influyeron los partidos sin público durante la pandemia en la capacidad de anotar goles por parte de los equipos que jugaron de visitante?

3) ¿Tuvo influencia la implementación del Video Assistant Referee (VAR), en la cantidad de goles que ofrecían las respectivas ligas?

4) ¿Puede distinguir un cambio de entrenador y/o jugadores del equipo para un dominio del marcador en su mayoría de juegos?


\pagebreak
# Resumen Descriptivo de la BBDD

 A continuación, un cuadro con detalles de la estadística descriptiva para la evaluación de las variables numéricas de la base de datos en estudio.

```{r Resumen Descriptivo - Futbol, echo=FALSE}
Partidos <- dbGetQuery(futbol, 
"SELECT Goles_Local, Goles_Visitante FROM Partidos")

tb_resumen1 <- Partidos %>% descr(stats = c("mean", "sd", "min", "q1", "med", "q3", "max","cv"), transpose = TRUE) %>% tb(order = 3) %>% mutate("Total de datos"=c(length(Partidos$Goles_Local), length(Partidos$Goles_Visitante)), Moda=c(moda(Partidos$Goles_Local), moda(Partidos$Goles_Visitante))) %>% select(c(1, 10, 11, 2, 3, 4, 5, 6, 7, 8, 9)) %>% rename(Variable=variable, Media=mean, Desv_std=sd, Min=min, Q1=q1, Med=med, Q3=q3, Max=max, CV=cv) %>% mutate(Variable= recode(Variable, "Goles_Local" = "Goles Local", "Goles_Visitante" = "Goles Visitante")) %>% mutate(CV=CV*100) %>% mutate(across(c(4,5,11), ~ round(., 2)))

tb_resumen1 %>% kable() %>% kable_styling(bootstrap_options = c("striped", "hover")) %>% column_spec(1, bold = T,  background="#E0E0E0") %>% row_spec(0, bold = T, background="#E0E0E0")

remove(tb_resumen1, Partidos)
```

## Goles Realizados por los Equipos Jugando como Local

* Hay un total de 123.404 datos o registros.
* La moda (número que más se repite) es 1 gol.
* El promedio de goles anotados de los equipos jugando como local es de 1,48.
* La desviación estándar nos dice que hay una dispersión de los datos de 1,25 aproximadamente.
* El valor mínimo presentado en goles anotados de los locales es de 0.
* Dado que el cuartil 1 es de 1, nos dice que el 25% de los datos son menores o igual a 1 gol por parte de los equipos locales.
* Dado que la mediana es de 1, nos dice que el 50% de los datos son menores o igual a 1 gol por parte de los equipos locales.
* Dado que el cuartil 3 es de 2, nos dice que el 25% de los datos son mayores a 2 goles por parte de los equipos locales.
* El valor máximo presentado en goles anotados de los locales es de 10.
* Obtenemos un coeficiente de variación de 84,61%, lo que nos dice que los goles locales presentan una variabilidad alta.

## Goles Realizados por los Equipos Jugando como Visitantes

* Hay un total de 123.404 datos o registros.
* La moda (número que más se repite) es 1 gol.
* El promedio de goles anotados de los equipos jugando como visitante es de 1,14.
* La desviación estándar nos dice que hay una dispersión de los datos de 1,11 aproximadamente.
* El valor mínimo presentado en goles anotados de los visitantes es de 0.
* Dado que el cuartil 1 es de 0, nos dice que el 25% de los datos son menores o igual a 0 goles por parte de los equipos visitantes.
* Dado que la mediana es de 1, nos dice que el 50% de los datos son mayores o igual a 1 gol por parte de los equipos visitantes.
* Dado que el cuartil 3 es de 2, nos dice que el 25% de los datos son mayores o iguales a 2 goles por parte de los equipos visitantes.
* El valor máximo presentado en goles anotados de los visitantes es de 13.
* Obtenemos un coeficiente de variación de 97,14%, lo que nos dice que los goles locales presentan una variabilidad alta.

\pagebreak
# ¿Los equipos tienden a ganar más cuando juegan en sus estadios locales?

 Se procede a evaluar los resultados de todos los juegos de la BBDD donde "Athetic Club" y el "Manchester City" juegan de local y serán comparados con los resultados donde juegan de visitante, de esta manera se visualizará en que posición se han llevado más victorias.
 
 También es importante mencionar que son todos sus partidos en sus ligas desde la temporada 2005-06 hasta la 2020-21.

## Distribución de Frecuencias de los Resultados de los Partidos - Athetic Club Bilbao

 A continuación un histograma de frecuencias que nos indican los resultados de los partidos totales del Athletic Club en La Liga.

```{r Frec_Athletic_col, echo=FALSE, warning=FALSE, message=FALSE}
ath_plot <- v_ath %>% group_by(Lugar, Ganador) %>% summarise(Total= n())%>% 
mutate(Porcentaje=round(Total/sum(Total)*100, 1), Proporcion=round(Total/sum(Total), 2))

ggplot(ath_plot, aes(x=Lugar, y=Total, fill=Ganador)) + geom_col(position="dodge",colour="black") + labs(y="Frecuencia") + ggtitle("Registro de Partidos - Athletic Club de Bilbao") + theme_test() + ylim(c(0,160)) + scale_fill_manual(values=c("#CE93D8", "#9C27BD", "#BA68CB")) + theme(plot.title=element_text(hjust = 0.5, size=11)) +
geom_text(aes(label=paste0(Total," ", "", "(", Porcentaje, "%", ")")),
         vjust=-0.5, 
         color="black", 
         hjust=0.5,
         position = position_dodge(0.9), 
         size=3.0)
```

 Podemos observar en la gráfica que Athletic jugando de local: \
- Ha ganado el 47,7% de sus partidos. \
- Ha perdido el 26,3% de sus partidos. \
- Ha empatado el 26% de sus partidos. 

 Por otra parte, Athletic jugando como visitante: \
- Ha ganado el 25,3% de sus partidos. \
- Ha perdido el 47,4% de sus partidos. \
- Ha empatado el 27,3% de sus partidos.

## Distribución de Frecuencias de los Resultados de los Partidos - Manchester City

 A continuación un histograma de frecuencias que nos indican los resultados de los partidos totales del Manchester City en la Premier Ligue.

```{r Frec_Mancherster_col, echo=FALSE, warning=FALSE, message=FALSE}
man_plot <- v_man %>% group_by(Lugar, Ganador) %>% summarise(Total= n()) %>% 
mutate(Porcentaje = round(Total/sum(Total)*100, 1), Proporcion=round(Total/sum(Total), 2))

ggplot(man_plot, aes(x=Lugar, y=Total, fill=Ganador)) + geom_col(position="dodge",colour="black") + labs(y="Frecuencia") + ggtitle("Registro de Partidos - Manchester City") + theme_test() + ylim(c(0,220)) + scale_fill_manual(values=c("#CE93D8", "#9C27BD", "#BA68CB")) + theme(plot.title=element_text(hjust = 0.5, size=11)) + geom_text(aes(label=paste0(Total," ", "", "(", Porcentaje, "%", ")")),
         vjust=-0.5, 
         color="black", 
         hjust=0.5,
         position = position_dodge(0.9), 
         size=3.0)
```

 Podemos observar en la gráfica que el Manchester City jugando de local: \
- Ha ganado el 69,4% de sus partidos. \
- Ha perdido el 16,5% de sus partidos. \
- Ha empatado el 14,1% de sus partidos. 

 Por otra parte, el Manchester City jugando como visitante: \
- Ha ganado el 47% de sus partidos. \
- Ha perdido el 31,9% de sus partidos.\
- Ha empatado el 21,1% de sus partidos. 

### Distribución de Densidad de los Resultados de los Partidos de los Equipos - Athetic y Manchester

 Adentrándonos en estas frecuencias y porcentajes, podemos estudiar su composición de proporciones, lo que nos ayuda a medir en una misma escala todo, y notar a simple vista lo que ocurre en comparación entre los equipos.

```{r Dens_ath-man_col, echo=FALSE}
g1 <- ggplot(ath_plot, aes (x=Lugar, y=Proporcion, fill=Ganador)) + geom_col(color="black", position="fill") + scale_fill_manual(values=c("#CE93D8", "#9C27BD", "#BA68CB")) + theme_bw() + labs(y="Proporciones") + ggtitle("Densidad de los Resultados \n(Athletic Club)") + theme(plot.title=element_text(size=11))

g2 <- ggplot(man_plot, aes (x=Lugar, y=Proporcion, fill=Ganador)) + geom_col(color="black", position="fill") + scale_fill_manual(values=c("#CE93D8", "#9C27BD", "#BA68CB")) + theme_bw() + labs(y="Proporciones") + ggtitle("Densidad de los Resultados \n(Manchester City)") + theme(plot.title=element_text(size=11))

plot_grid(g1, g2, nrow=1)

remove(v_ath, v_man, ath_plot, man_plot, g1, g2)
```

 Se puede apreciar que el Athletic Club tiene un mejor rendimiento si juega como local, con una mayor proporción de victorias acumuladas delante las otras entre las temporadas 2005-06 a la la 2020-21.
 
 Al igual que el equipo anterior, el Manchester City tiene una mayor tasa de victorias jugando como local, pero también se aprecia que a su vez ha ganado la mayor parte de la proporción de partidos jugando como visitante. Entonces se puede decir que es un destacable equipo de la premier ligue, pero tiene un mejor rendimiento jugando de local.
 
 Como dato, el que un equipo tenga muchas victorias jugando de local puede tener más detalles a considerar, como el sentido de comodidad por jugar en su "hogar" del equipo, una mayor cantidad de afición apoyandolos en los asientos a comparación del equipo rival, entre otros.

## Conclusión de 1er Objetivo

 Si, los equipos jugando de manera local suelen tener una ventaja de victoria delante su rival. Presentan una mayor proporción de ganar delante los otros dos posibles resultados (empatar o perder) en la muestra, y por regularidad estadística, si se toma una muestra de un espacio muestral, se va a comportar igual al espacio muestra.
 
 Se respalda esta información con el artículo que hizo Fatima Juan Belmonte, una reportera de prensa deportiva. Mediante hechos con respecto a un equipo español, demostró la importancia de la afición a su equipo, la fuente de motivación que son para el mismo e incluso su relevancia a la hora de nuevos fichajes.

 También Carlos Cueva, profesor de Economía de la Universidad de Alicante, realizó un estudio sobre 41 ligas (antes y después de que comenzó la pandemia), y comprobó que la afición local genera una presión al equipo visitante, recopilando resultados, se notó que sin la afición de ninguna de las partes, los equipos visitantes aumenta su tasa de victoria hasta un 12% por temporada, pero nunca es mayor a la tasa de victorias local.

\pagebreak
# Bibliografía

* Belmonte, F. (2017, noviembre 19). La importancia de la afición. VAVEL. Recuperado de https://www.vavel.com/es/futbol/2017/11/19/rayo-vallecano/849777-la-importancia-de-la-aficion.html

* Guerrero, S. (2021, febrero 18). ¿Cuál es la influencia de las hinchadas locales en el fútbol?. PRIMICIAS. Recuperado de https://www.primicias.ec/noticias/jugada/peso-influencia-hinchada-equipos-locales-estadios-futbol/

* CAMBIOS DE ENTRENADORES DURANTE LA TEMPORADA. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/laliga/trainerwechsel/wettbewerb/ES1/plus/?saison_id=2018

* CAMBIOS DE ENTRENADORES DURANTE LA TEMPORADA. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/laliga/trainerwechsel/wettbewerb/ES1/plus/?saison_id=2017

* IMPACTO DE ENTRENADOR. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/laliga/trainereffekt/wettbewerb/ES1/plus/?saison_id=2018&spiele=15

* IMPACTO DE ENTRENADOR. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/laliga/trainereffekt/wettbewerb/ES1/plus/?saison_id=2017&spiele=15

* EQUIPO ATHLETIC CLUB - TEMPORADA 18/19. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/athletic-club/kader/verein/621/plus/0/galerie/0?saison_id=2018

* EQUIPO ATHLETIC CLUB - TEMPORADA 17/18. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/athletic-club/kader/verein/621/plus/0/galerie/0?saison_id=2017

* EQUIPO RC CELTA DE VIGO - TEMPORADA 18/19. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/rc-celta-de-vigo/kader/verein/940/plus/0/galerie/0?saison_id=2018

* EQUIPO RC CELTA DE VIGO - TEMPORADA 17/18. (s.f.). transfer markt. Recuperado de https://www.transfermarkt.es/rc-celta-de-vigo/kader/verein/940/plus/0/galerie/0?saison_id=2017